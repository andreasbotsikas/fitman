{% extends "base.html" %}

{% block title %}{{ query_name }}{% endblock %}

{% block menu %}
<li xmlns="http://www.w3.org/1999/html" xmlns="http://www.w3.org/1999/html"><a
        title="settings" href="/settings">settings</a></li>
<li><a title="logout" href="/logout">logout</a></li>
{%  endblock%}

{% block extra_header %}
<style>
    .crop{
        float:left;
        margin:.5em 10px .5em 0;
        overflow:hidden; /* this is important */
        border:1px solid #ccc;
        height: 100px;
        width: 100px;
    }
        /* input values to crop the image: top, right, bottom, left */
    .crop img{
        margin:-20px -15px -40px -55px;
    }

</style>
<script type="text/javascript" charset="utf-8">
    $(document).ready(function () {
        $('#table').dataTable({
            "bJQueryUI": true,
            "sPaginationType": "full_numbers",
            "aaSorting" : [[3, 'desc']],
            "aaData": [
                {% autoescape on %}
                {% for message in response %}
                    {% if message.doc.senti_tag == "positive" %}
                        ["<select class=\"train\" name=\"{{ message.meta.id }}\"><option value=\"positive\" selected=true>positive</option><option value=\"negative\">negative</option><option value=\"neutral\" >neutral</option></select>","{{ message.doc.text|linebreaksbr }}", "{{ message.doc.user_screen_name }}","{{ message.doc.created_at}}"],
                    {%  elif message.doc.senti_tag == "negative" %}
                        ["<select class=\"train\" name=\"{{ message.meta.id}}\"><option value=\"positive\"  >positive</option><option value=\"negative\" selected=true >negative</option><option value=\"neutral\">neutral</option></select>","{{ message.doc.text|linebreaksbr }}", "{{ message.doc.user_screen_name }}","{{ message.doc.created_at}}"],
                    {%  elif message.doc.senti_tag == "neutral" %}
                        ["<select class=\"train\" name=\"{{ message.meta.id}}\"><option value=\"positive\"  >positive</option><option value=\"negative\" >negative</option><option value=\"neutral\" selected=true >neutral</option></select>","{{ message.doc.text|linebreaksbr }}", "{{ message.doc.user_screen_name }}","{{ message.doc.created_at}}"],
                    {% else %}
                        ["<select class=\"train\" name=\"{{ message.meta.id }}\"><option value=\"positive\">positive</option><option value=\"negative\" >negative</option><option value=\"neutral\">neutral</option><option value=\"na\" selected=true>n/a</option></select>","{{ message.doc.text|linebreaksbr }}", "{{ message.doc.user_screen_name }}","{{ message.doc.created_at}}"],
                    {% endif %}
                {% empty %}
                    ["-","-", "-","-"]
                {% endfor %}
                {% endautoescape %}
            ],
            "aoColumns": [
                { "sTitle": "Sentiment"},
                { "sTitle": "Text"},
                { "sTitle": "From"},
                { "sTitle": "Datetime"}
            ],
            "aoColumnDefs": [
                { "sWidth": "auto", "aTargets": [ 0 ] },
                { "sWidth": "auto", "aTargets": [ 2 ] }
            ]
        });
    });
</script>
<!-- flat-tabs -->
<!--link href="/s/css/flat-tabs.css" rel="stylesheet"-->
<!-- Google Charts-->
<script type="text/javascript" src="https://www.google.com/jsapi"></script>
<script type="text/javascript">
    google.load("visualization", "1", {packages: ["treemap"]});
    google.setOnLoadCallback(drawChart);
    function drawChart() {
        // Create and populate the data table.
        var data = google.visualization.arrayToDataTable([
            ['Keyword', 'Parent', 'Number of appearance (size)', 'Sentiment(color)'],
            ['All', null, 0, 0],
    {% for category in categories %}
            ['{{ category.category }}', 'All', 0, 0],
        {% for property in category.properties %}
            ['{{ category.category }}:{{ property.name }}', '{{ category.category }}', {{ property.times }}, {{ property.sentiment}}],
        {% endfor %}
    {% endfor %}
            //['Materials', 'All', 0, 0],
            //['leather', 'Materials', 5, -5],
        ]);

        // Create and draw the visualization.
        var tree = new google.visualization.TreeMap(document.getElementById('chart_div'));
        tree.draw(data, {
            minColor: '#f00',
            midColor: '#ddd',
            maxColor: '#0d0',
            headerHeight: 15,
            fontColor: 'black',
            showScale: true});
    }
</script>
<!-- piechart-->
<script type="text/javascript">
    google.load("visualization", "1", {packages: ["corechart"]});
    google.setOnLoadCallback(drawChart);
    function drawChart() {
        var data = google.visualization.arrayToDataTable([
            ['Messages', 'Number'],
            ['Positive', {{ positive }}],
            ['Negative', {{ negative }}],
            ['Neutral', {{ neutral }}]
        ]);

        var options = {
            colors: [ '#A5DF00', '#FA8258', '#BDBDBD'],
            width: 700,
            height: 500,
            backgroundColor: 'none',
            is3D: true,
            title: ''
        };

        var chart = new google.visualization.PieChart(document.getElementById('piechart'));
        chart.draw(data, options);
    }
</script>

<script type="text/javascript" src="/s/js/bootstrap.js"></script>
<script type="text/javascript">
    jQuery(document).ready(function ($) {
        $('#tabs').tab();
    });
</script>


<script type="text/javascript" charset="utf-8">
    $( document ).ready(function() {
        //console.log( "ready!" );

        $('select').on('change', function() {
            //console.log ( this.name + " : "+this.value ); // or $(this).val()
            $('#retrain').val($('#retrain').val() + this.name + ":"+this.value + ",");
        });
    });
</script>

    <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="http://blueimp.github.io/Gallery/css/blueimp-gallery.min.css">
    <link rel="stylesheet" href="/s/css/bootstrap-image-gallery.min.css">

{% endblock %}

{% block body %}

    <div class="container">
        <h1 class="brand pull-left">Query: {{ query_name }}</h1>
         <a data-toggle="modal" href="/query/delete/{{ query_id }}" class="btn btn-primary pull-right"><i class="fa fa-trash-o"></i> Delete</a>
    </div>

<!-- Textual Results -->
<div class="container">

    <!-- Four columns -->
    <h1 class="brand pull-left">Sentiment Analysis</h1>
    <hr width="100%">
    <div class="row">
        <table id="table">
            <thead class="nav"></thead>
            <tbody></tbody>
            <tfoot></tfoot>
        </table>

        <!-- the retrain form goes here-->

        <div class="span12">
            <div class="cform" id="theme-form">
                <form action="/results-update" method="post" class="cform-form">
                    {% csrf_token %}
                    <input id="results-id" type="hidden" name="results-id" value="{{ query_id }}">
                    <input id="retrain" type="hidden" name="retrain">
                    <input id="update" type="submit" value='Save' class="cform-submit pull-right">
                </form>
            </div>
        </div>


        <!-- /.table-queries -->
    </div>

    <!-- /.row -->
</div>
<!-- /.container -->
<!-- Graphs -->
<div class="container">
<br/>
    <!-- row: pie for sentiments and blocks for terms-->
    <div class="row">

    <!-- /. row-->
    <!-- row: treemap for sentiments and blocks for terms-->
        <div class="span7">
            <div id="chart_div" style="width: auto; height: 500px;">Google Charts loading</div>
            <div>*left-click on a category to see keywords, right-click to navigate back</div>
        </div>
        <div class="span5">
            <div id="piechart" style="width: auto; height: 500px;"></div>
        </div>
     </div>
    <!-- /. row-->
</div>
<div class="container">
    <!-- row: Tabs for categories-->
    <h1 class="brand pull-left">Frequency of Categories</h1>
    <hr width="100%">
    <div class="row">
        <div class="span9">
            <ul id="tabs" class="nav nav-tabs" data-tabs="tabs">
                {% for category in categories %}
                    {% if forloop.counter == 1 %}
                        <li class="active"><a href="#{{ category.category }}" data-toggle="tab">{{ category.category }}</a></li>
                    {% else %}
                        <li><a href="#{{ category.category }}" data-toggle="tab">{{ category.category }}</a></li>
                    {% endif %}
                {% empty %}
                {% endfor %}
            </ul>
            <div id="my-tab-content" class="tab-content" style="width: auto">
                {% for category in categories %}
                    {% if forloop.counter == 1 %}
                        <div class="tab-pane active" id="{{ category.category }}">
                    {% else %}
                        <div class="tab-pane" id="{{ category.category }}">
                    {% endif %}

                    <div id="pie_{{ category.category }}" style="width: auto; height: auto;">Google Pie Chart for Category</div>
                    <script type="text/javascript">
                        google.load("visualization", "1", {packages: ["corechart"]});
                        google.setOnLoadCallback(drawChart);
                        function drawChart() {
                            var data = google.visualization.arrayToDataTable([
                                ['Messages', 'Number'],
                                {% for property in category.properties %}
                                    ['{{ property.name }}' , {{ property.times }}],
                                {% endfor %}
                            ]);

                            var options = {
                                width: 800,
                                height: 500,
                                backgroundColor: 'none',
                                is3D: true
                            };

                            var chart = new google.visualization.PieChart(document.getElementById('pie_{{ category.category }}'));
                            chart.draw(data, options);
                        }
                    </script>
                    <!--div id="trend_brands" style="width: 900px; height: 500px;">Google Trend line for Category</div>
                    <script>
                            google.load("visualization", "1", {packages: ["annotatedtimeline"]});
                            google.setOnLoadCallback(drawTrendLine);
                            function drawTrendLine() {
                                var data = new google.visualization.DataTable();
                                data.addColumn('date', 'Date');
                                data.addColumn('number', 'AIDIMA');
                                data.addColumn('string', 'company');
                                data.addColumn('number', 'NEOSET');
                                data.addColumn('string', 'company');
                                data.addColumn('number', 'IKEA');
                                data.addColumn('string', 'company');
                                data.addRows([
                                    [new Date(2008, 1, 1), 30000, 'AIDIMA', 40645, 'NEOSET', 2000, 'IKEA'],
                                    [new Date(2008, 1, 2), 14045, null, 20374, null, 33233, null],
                                    [new Date(2008, 1, 3), 55022, null, 50766, null, 21233, null]
                                ]);

                                var annotatedtimeline = new google.visualization.AnnotatedTimeLine(
                                        document.getElementById('trend_brands'));
                                annotatedtimeline.draw(data, {'displayAnnotations': true});
                            }
                        </script>
                    </div!-->
                </div>
                {% empty %}

                {% endfor %}
        </div>
    </div>
    <!-- /. row-->

</div>
    </div>
 </div>
<!-- /.container -->

<!-- Image Gallery-->

<div class="container">
    <div class="row">
        <!-- The Bootstrap Image Gallery lightbox, should be a child element of the document body -->
        <div id="blueimp-gallery" class="blueimp-gallery">
            <!-- The container for the modal slides -->
            <div class="slides"></div>
            <!-- Controls for the borderless lightbox -->
            <h3 class="title"></h3>
            <a class="prev">‹</a>
            <a class="next">›</a>
            <a class="close">×</a>
            <a class="play-pause"></a>
            <ol class="indicator"></ol>
            <!-- The modal dialog, which will be used to wrap the lightbox content -->
            <div class="modal fade">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" aria-hidden="true">&times;</button>
                            <h4 class="modal-title"></h4>
                        </div>
                        <div class="modal-body next"></div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default pull-left prev">
                                <i class="glyphicon glyphicon-chevron-left"></i>
                                Previous
                            </button>
                            <button type="button" class="btn btn-primary next">
                                Next
                                <i class="glyphicon glyphicon-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="links">
            {% for message in response %}
                {% for media in message.doc.entities.media %}
                    <a href="{{ media.media_url_https }}" title="{{ message.doc.senti_tag }} @{{ message.doc.user_screen_name }} : {{ message.doc.text|linebreaksbr }}" data-gallery>
                        <img src="{{ media.media_url_https }}" alt="{{ message.doc.user_screen_name }}" class="crop">
                    </a>
                {% endfor %}
            {% endfor %}
        </div>
    </div>
</div>

{% endblock %}


{% block end_of_body %}
    <script src="http://blueimp.github.io/Gallery/js/jquery.blueimp-gallery.min.js"></script>
    <script src="/s/js/bootstrap-image-gallery.min.js"></script>


{% endblock %}